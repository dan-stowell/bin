#!/usr/bin/env bash

git add -A

if git diff --quiet && git diff --cached --quiet; then
  echo "No changes to commit"
  exit 0
fi

DIFF=$(git diff --cached)

COMMIT_MSG=$(echo "$DIFF" | llm --model openrouter/mistralai/mistral-small --system "Generate a concise commit message for this git diff. Return only the commit message itself, nothing else.")

COMMIT_MSG="${COMMIT_MSG#\"}"
COMMIT_MSG="${COMMIT_MSG%\"}"

if [ $? -ne 0 ] || [ -z "$COMMIT_MSG" ]; then
  echo "Error: Failed to generate commit message"
  exit 1
fi

git commit -m "$COMMIT_MSG"
